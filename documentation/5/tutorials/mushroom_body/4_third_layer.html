<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Output neurons and learning &mdash; PyGeNN  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Testing" href="5_testing.html" />
    <link rel="prev" title="Feedback-inhibition based gain control" href="3_second_layer_gain_control.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            PyGeNN
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrading.html">Upgrading from GeNN 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_networks.html">Building networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simulating_networks.html">Simulating networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../custom_models.html">Custom models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../comp_neuro_101/1_neurons.html">Defining populations of neurons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../comp_neuro_101/2_synapses.html">Adding synapses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mnist_inference/tutorial_1.html">Classification of a single digit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mnist_inference/tutorial_2.html">Classification of the entire test set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mnist_inference/tutorial_3.html">Faster classification of the whole test set</a></li>
<li class="toctree-l2"><a class="reference internal" href="1_first_layer.html">Presenting latency-coded inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_second_layer.html">Adding Kenyon Cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_second_layer_gain_control.html">Feedback-inhibition based gain control</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Output neurons and learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_testing.html">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../userproject/index.html">User projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/pygenn.html">Reference documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PyGeNN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Output neurons and learning</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tutorials/mushroom_body/4_third_layer.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Output-neurons-and-learning">
<h1>Output neurons and learning<a class="headerlink" href="#Output-neurons-and-learning" title="Permalink to this heading"></a></h1>
<p>In this tutorial we add Mushroom Body Output Neurons (MBONS) to the model and train the weights connecting them to the Kenyon Cells using a simple event-driven STDP rule.</p>
<section id="Install-PyGeNN-wheel-from-Google-Drive">
<h2>Install PyGeNN wheel from Google Drive<a class="headerlink" href="#Install-PyGeNN-wheel-from-Google-Drive" title="Permalink to this heading"></a></h2>
<p>Download wheel file</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_ipython</span><span class="p">()):</span>
    <span class="c1">#import IPython</span>
    <span class="c1">#IPython.core.magics.execution.ExecutionMagics.run.func_defaults[2] = lambda a: a</span>
    <span class="c1">#%run &quot;../install_collab.ipynb&quot;</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>gdown<span class="w"> </span>--upgrade
    <span class="o">!</span>gdown<span class="w"> </span>1V_GzXUDzcFz9QDIpxAD8QNEglcSipssW
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pygenn-5.0.0-cp310-cp310-linux_x86_64.whl
    <span class="o">%</span><span class="k">env</span> CUDA_PATH=/usr/local/cuda
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Requirement already satisfied: gdown in /usr/local/lib/python3.10/dist-packages (5.1.0)
Requirement already satisfied: beautifulsoup4 in /usr/local/lib/python3.10/dist-packages (from gdown) (4.12.3)
Requirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from gdown) (3.13.1)
Requirement already satisfied: requests[socks] in /usr/local/lib/python3.10/dist-packages (from gdown) (2.31.0)
Requirement already satisfied: tqdm in /usr/local/lib/python3.10/dist-packages (from gdown) (4.66.2)
Requirement already satisfied: soupsieve&gt;1.2 in /usr/local/lib/python3.10/dist-packages (from beautifulsoup4-&gt;gdown) (2.5)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.10/dist-packages (from requests[socks]-&gt;gdown) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.10/dist-packages (from requests[socks]-&gt;gdown) (3.6)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests[socks]-&gt;gdown) (2.0.7)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests[socks]-&gt;gdown) (2024.2.2)
Requirement already satisfied: PySocks!=1.5.7,&gt;=1.5.6 in /usr/local/lib/python3.10/dist-packages (from requests[socks]-&gt;gdown) (1.7.1)
Downloading...
From: https://drive.google.com/uc?id=1V_GzXUDzcFz9QDIpxAD8QNEglcSipssW
To: /content/pygenn-5.0.0-cp310-cp310-linux_x86_64.whl
100% 8.29M/8.29M [00:00&lt;00:00, 101MB/s]
Processing ./pygenn-5.0.0-cp310-cp310-linux_x86_64.whl
Requirement already satisfied: numpy&gt;=1.17 in /usr/local/lib/python3.10/dist-packages (from pygenn==5.0.0) (1.25.2)
Requirement already satisfied: deprecated in /usr/local/lib/python3.10/dist-packages (from pygenn==5.0.0) (1.2.14)
Requirement already satisfied: psutil in /usr/local/lib/python3.10/dist-packages (from pygenn==5.0.0) (5.9.5)
Requirement already satisfied: wrapt&lt;2,&gt;=1.10 in /usr/local/lib/python3.10/dist-packages (from deprecated-&gt;pygenn==5.0.0) (1.14.1)
pygenn is already installed with the same version as the provided wheel. Use --force-reinstall to force an installation of the wheel.
env: CUDA_PATH=/usr/local/cuda
</pre></div></div>
</div>
</section>
<section id="Install-MNIST-package">
<h2>Install MNIST package<a class="headerlink" href="#Install-MNIST-package" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>mnist
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Collecting mnist
  Downloading mnist-0.2.2-py2.py3-none-any.whl (3.5 kB)
Requirement already satisfied: numpy in /usr/local/lib/python3.10/dist-packages (from mnist) (1.25.2)
Installing collected packages: mnist
Successfully installed mnist-0.2.2
</pre></div></div>
</div>
</section>
<section id="Build-tutorial-model">
<h2>Build tutorial model<a class="headerlink" href="#Build-tutorial-model" title="Permalink to this heading"></a></h2>
<p>Import modules</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mnist</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">pygenn</span> <span class="kn">import</span> <span class="p">(</span><span class="n">create_current_source_model</span><span class="p">,</span> <span class="n">create_neuron_model</span><span class="p">,</span> <span class="n">create_weight_update_model</span><span class="p">,</span>
                    <span class="n">init_postsynaptic</span><span class="p">,</span> <span class="n">init_sparse_connectivity</span><span class="p">,</span> <span class="n">init_weight_update</span><span class="p">,</span> <span class="n">GeNNModel</span><span class="p">)</span>

<span class="c1"># Reshape and normalise training data</span>
<span class="n">training_images</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">train_images</span><span class="p">()</span>
<span class="n">training_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">training_images</span><span class="p">,</span> <span class="p">(</span><span class="n">training_images</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">training_images</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">training_images</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
<span class="n">training_labels</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">train_labels</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
</pre></div>
</div>
</div>
</section>
<section id="Parameters">
<h2>Parameters<a class="headerlink" href="#Parameters" title="Permalink to this heading"></a></h2>
<p>Define some model parameters</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulation time step</span>
<span class="n">DT</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># Scaling factor for converting normalised image pixels to input currents (nA)</span>
<span class="n">INPUT_SCALE</span> <span class="o">=</span> <span class="mf">80.0</span>

<span class="c1"># Number of Projection Neurons in model (should match image size)</span>
<span class="n">NUM_PN</span> <span class="o">=</span> <span class="mi">784</span>

<span class="c1"># Number of Kenyon Cells in model (defines memory capacity)</span>
<span class="n">NUM_KC</span> <span class="o">=</span> <span class="mi">20000</span>

<span class="c1"># How long to present each image to model</span>
<span class="n">PRESENT_TIME_MS</span> <span class="o">=</span> <span class="mf">20.0</span>

<span class="c1"># Standard LIF neurons parameters</span>
<span class="n">LIF_PARAMS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="s2">&quot;TauM&quot;</span><span class="p">:</span> <span class="mf">20.0</span><span class="p">,</span>
    <span class="s2">&quot;Vrest&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">60.0</span><span class="p">,</span>
    <span class="s2">&quot;Vreset&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">60.0</span><span class="p">,</span>
    <span class="s2">&quot;Vthresh&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="s2">&quot;Ioffset&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s2">&quot;TauRefrac&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">}</span>

<span class="c1"># We only want PNs to spike once</span>
<span class="n">PN_PARAMS</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">LIF_PARAMS</span><span class="p">)</span>
<span class="n">PN_PARAMS</span><span class="p">[</span><span class="s2">&quot;TauRefrac&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100.0</span>

<span class="c1"># Weight of each synaptic connection</span>
<span class="n">PN_KC_WEIGHT</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="c1"># Time constant of synaptic integration</span>
<span class="n">PN_KC_TAU_SYN</span> <span class="o">=</span> <span class="mf">3.0</span>

<span class="c1"># How many projection neurons should be connected to each Kenyon Cell</span>
<span class="n">PN_KC_FAN_IN</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1"># We will use weights of 1.0 for KC-&gt;GGN connections and</span>
<span class="c1"># want the GGN to inhibit the KCs after 200 spikes</span>
<span class="n">GGN_PARAMS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Vthresh&quot;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>As we’re now going to be adding our synaptic connections between the Projection Neurons and a new population of Kenyon Cells, also define some parameter for these</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NUM_MBON</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">MBON_STIMULUS_CURRENT</span> <span class="o">=</span> <span class="mf">5.0</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">KC_MBON_TAU_SYN</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">KC_MBON_PARAMS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tau&quot;</span><span class="p">:</span> <span class="mf">15.0</span><span class="p">,</span>
                  <span class="s2">&quot;rho&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
                  <span class="s2">&quot;eta&quot;</span><span class="p">:</span> <span class="mf">0.00002</span><span class="p">,</span>
                  <span class="s2">&quot;wMin&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                  <span class="s2">&quot;wMax&quot;</span><span class="p">:</span> <span class="mf">0.0233</span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="Custom-models">
<h2>Custom models<a class="headerlink" href="#Custom-models" title="Permalink to this heading"></a></h2>
<p>As well as the models we defined before:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Current source model, allowing current to be injected into neuron from variable</span>
<span class="n">cs_model</span> <span class="o">=</span> <span class="n">create_current_source_model</span><span class="p">(</span>
    <span class="s2">&quot;cs_model&quot;</span><span class="p">,</span>
    <span class="nb">vars</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;magnitude&quot;</span><span class="p">,</span> <span class="s2">&quot;scalar&quot;</span><span class="p">)],</span>
    <span class="n">injection_code</span><span class="o">=</span><span class="s2">&quot;injectCurrent(magnitude);&quot;</span><span class="p">)</span>

<span class="c1"># Minimal integrate and fire neuron model</span>
<span class="n">if_model</span> <span class="o">=</span> <span class="n">create_neuron_model</span><span class="p">(</span>
    <span class="s2">&quot;IF&quot;</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Vthresh&quot;</span><span class="p">],</span>
    <span class="nb">vars</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;scalar&quot;</span><span class="p">)],</span>
    <span class="n">sim_code</span><span class="o">=</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    V += Isyn;</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">threshold_condition_code</span><span class="o">=</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    V &gt;= Vthresh</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">reset_code</span><span class="o">=</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    V = 0.0;</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We now also need an STDP learning rule!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">symmetric_stdp</span> <span class="o">=</span> <span class="n">create_weight_update_model</span><span class="p">(</span>
    <span class="s2">&quot;symmetric_stdp&quot;</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tau&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;eta&quot;</span><span class="p">,</span> <span class="s2">&quot;wMin&quot;</span><span class="p">,</span> <span class="s2">&quot;wMax&quot;</span><span class="p">],</span>
    <span class="nb">vars</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;scalar&quot;</span><span class="p">)],</span>
    <span class="n">pre_spike_syn_code</span><span class="o">=</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    const scalar dt = t - st_post;</span>
<span class="sd">    const scalar timing = exp(-dt / tau) - rho;</span>
<span class="sd">    const scalar newWeight = g + (eta * timing);</span>
<span class="sd">    g = fmin(wMax, fmax(wMin, newWeight));</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">post_spike_syn_code</span><span class="o">=</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    const scalar dt = t - st_pre;</span>
<span class="sd">    const scalar timing = fmax(exp(-dt / tau) - rho, -0.1*rho);</span>
<span class="sd">    const scalar newWeight = g + (eta * timing);</span>
<span class="sd">    g = fmin(wMax, fmax(wMin, newWeight));</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="Model-definition">
<h2>Model definition<a class="headerlink" href="#Model-definition" title="Permalink to this heading"></a></h2>
<p>Create a new model called “mnist_mb_second_layer_gain_control” as before although we no longer need to record spikes from individual neurons:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">GeNNModel</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;mnist_mb_third_layer&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">DT</span>

<span class="c1"># Create neuron populations</span>
<span class="n">lif_init</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="n">PN_PARAMS</span><span class="p">[</span><span class="s2">&quot;Vreset&quot;</span><span class="p">],</span> <span class="s2">&quot;RefracTime&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
<span class="n">if_init</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
<span class="n">pn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">add_neuron_population</span><span class="p">(</span><span class="s2">&quot;pn&quot;</span><span class="p">,</span> <span class="n">NUM_PN</span><span class="p">,</span> <span class="s2">&quot;LIF&quot;</span><span class="p">,</span> <span class="n">PN_PARAMS</span><span class="p">,</span> <span class="n">lif_init</span><span class="p">)</span>
<span class="n">kc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">add_neuron_population</span><span class="p">(</span><span class="s2">&quot;kc&quot;</span><span class="p">,</span> <span class="n">NUM_KC</span><span class="p">,</span> <span class="s2">&quot;LIF&quot;</span><span class="p">,</span> <span class="n">LIF_PARAMS</span><span class="p">,</span> <span class="n">lif_init</span><span class="p">)</span>
<span class="n">ggn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">add_neuron_population</span><span class="p">(</span><span class="s2">&quot;ggn&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">if_model</span><span class="p">,</span> <span class="n">GGN_PARAMS</span><span class="p">,</span> <span class="n">if_init</span><span class="p">)</span>

<span class="c1"># Turn on spike recording</span>
<span class="n">pn</span><span class="o">.</span><span class="n">spike_recording_enabled</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">kc</span><span class="o">.</span><span class="n">spike_recording_enabled</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Create current sources to deliver input to network</span>
<span class="n">pn_input</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">add_current_source</span><span class="p">(</span><span class="s2">&quot;pn_input&quot;</span><span class="p">,</span> <span class="n">cs_model</span><span class="p">,</span> <span class="n">pn</span> <span class="p">,</span> <span class="p">{},</span> <span class="p">{</span><span class="s2">&quot;magnitude&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>

<span class="c1"># Create synapse populations</span>
<span class="n">pn_kc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">add_synapse_population</span><span class="p">(</span><span class="s2">&quot;pn_kc&quot;</span><span class="p">,</span> <span class="s2">&quot;SPARSE&quot;</span><span class="p">,</span>
                                     <span class="n">pn</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span>
                                     <span class="n">init_weight_update</span><span class="p">(</span><span class="s2">&quot;StaticPulseConstantWeight&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;g&quot;</span><span class="p">:</span> <span class="n">PN_KC_WEIGHT</span><span class="p">}),</span>
                                     <span class="n">init_postsynaptic</span><span class="p">(</span><span class="s2">&quot;ExpCurr&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;tau&quot;</span><span class="p">:</span> <span class="n">PN_KC_TAU_SYN</span><span class="p">}),</span>
                                     <span class="n">init_sparse_connectivity</span><span class="p">(</span><span class="s2">&quot;FixedNumberPreWithReplacement&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;num&quot;</span><span class="p">:</span> <span class="n">PN_KC_FAN_IN</span><span class="p">}))</span>

<span class="n">kc_ggn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">add_synapse_population</span><span class="p">(</span><span class="s2">&quot;kc_ggn&quot;</span><span class="p">,</span> <span class="s2">&quot;DENSE&quot;</span><span class="p">,</span>
                                      <span class="n">kc</span><span class="p">,</span> <span class="n">ggn</span><span class="p">,</span>
                                      <span class="n">init_weight_update</span><span class="p">(</span><span class="s2">&quot;StaticPulseConstantWeight&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;g&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}),</span>
                                      <span class="n">init_postsynaptic</span><span class="p">(</span><span class="s2">&quot;DeltaCurr&quot;</span><span class="p">))</span>

<span class="n">ggn_kc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">add_synapse_population</span><span class="p">(</span><span class="s2">&quot;ggn_kc&quot;</span><span class="p">,</span> <span class="s2">&quot;DENSE&quot;</span><span class="p">,</span>
                                      <span class="n">ggn</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span>
                                      <span class="n">init_weight_update</span><span class="p">(</span><span class="s2">&quot;StaticPulseConstantWeight&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;g&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">}),</span>
                                      <span class="n">init_postsynaptic</span><span class="p">(</span><span class="s2">&quot;ExpCurr&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;tau&quot;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">}))</span>
</pre></div>
</div>
</div>
<p>Add a current source to inject current into <code class="docutils literal notranslate"><span class="pre">pn</span></code> using our newly-defined custom model with the initial magnitude set to zero.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mbon</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">add_neuron_population</span><span class="p">(</span><span class="s2">&quot;mbon&quot;</span><span class="p">,</span> <span class="n">NUM_MBON</span><span class="p">,</span> <span class="s2">&quot;LIF&quot;</span><span class="p">,</span> <span class="n">LIF_PARAMS</span><span class="p">,</span> <span class="n">lif_init</span><span class="p">)</span>

<span class="n">mbon</span><span class="o">.</span><span class="n">spike_recording_enabled</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Create current sources to deliver input and supervision to network</span>
<span class="n">mbon_input</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">add_current_source</span><span class="p">(</span><span class="s2">&quot;mbon_input&quot;</span><span class="p">,</span> <span class="n">cs_model</span><span class="p">,</span> <span class="n">mbon</span> <span class="p">,</span> <span class="p">{},</span> <span class="p">{</span><span class="s2">&quot;magnitude&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p>Add a new synapse group connecting <code class="docutils literal notranslate"><span class="pre">kc</span></code> into <code class="docutils literal notranslate"><span class="pre">mbon</span></code> with initially zeroed weights and our newly-defined STDP rule.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kc_mbon</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">add_synapse_population</span><span class="p">(</span><span class="s2">&quot;kc_mbon&quot;</span><span class="p">,</span> <span class="s2">&quot;DENSE&quot;</span><span class="p">,</span>
                                       <span class="n">kc</span><span class="p">,</span> <span class="n">mbon</span><span class="p">,</span>
                                       <span class="n">init_weight_update</span><span class="p">(</span><span class="n">symmetric_stdp</span><span class="p">,</span> <span class="n">KC_MBON_PARAMS</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;g&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}),</span>
                                       <span class="n">init_postsynaptic</span><span class="p">(</span><span class="s2">&quot;ExpCurr&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;tau&quot;</span><span class="p">:</span> <span class="n">KC_MBON_TAU_SYN</span><span class="p">}))</span>
</pre></div>
</div>
</div>
</section>
<section id="Build-model">
<h2>Build model<a class="headerlink" href="#Build-model" title="Permalink to this heading"></a></h2>
<p>Generate code and load it into PyGeNN (as we’re no longer recording spikes, we don’t need to allocate a recording buffer)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert present time into timesteps</span>
<span class="n">present_timesteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">PRESENT_TIME_MS</span> <span class="o">/</span> <span class="n">DT</span><span class="p">))</span>

<span class="c1"># Build model and load it</span>
<span class="n">model</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">num_recording_timesteps</span><span class="o">=</span><span class="n">present_timesteps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Simulate-tutorial-model">
<h2>Simulate tutorial model<a class="headerlink" href="#Simulate-tutorial-model" title="Permalink to this heading"></a></h2>
<p>As well as resetting the state of every neuron after presenting each stimuli, because we have now added synapses with their own dynamics, these also need to be reset. This function resets neuron state variables selected by the keys of a dictionary to the values specifed in the dictionary values and pushes the new values to the GPU.</p>
<p>Now, like before, we loop through 4 stimuli and simulate the model. However, now we need to reset the Projection Neuron and Kenyon Cell populations; <strong>and</strong> the synapses between them. Additionally, we want to show spikes from the Kenyon Cells as well as the Projection Neurons.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reset_spike_times</span><span class="p">(</span><span class="n">pop</span><span class="p">):</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">spike_times</span><span class="o">.</span><span class="n">view</span><span class="p">[:]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">spike_times</span><span class="o">.</span><span class="n">push_to_device</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reset_out_post</span><span class="p">(</span><span class="n">pop</span><span class="p">):</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">out_post</span><span class="o">.</span><span class="n">view</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">out_post</span><span class="o">.</span><span class="n">push_to_device</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">reset_neuron</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">var_init</span><span class="p">):</span>
    <span class="c1"># Reset variables</span>
    <span class="k">for</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_val</span> <span class="ow">in</span> <span class="n">var_init</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">pop</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">var_val</span>

        <span class="c1"># Push the new values to GPU</span>
        <span class="n">pop</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">push_to_device</span><span class="p">()</span>

<span class="c1"># Convert present time into timesteps</span>
<span class="n">present_timesteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">PRESENT_TIME_MS</span> <span class="o">/</span> <span class="n">DT</span><span class="p">))</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">training_images</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
    <span class="c1"># Set training image</span>
    <span class="n">pn_input</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;magnitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">training_images</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">INPUT_SCALE</span>
    <span class="n">pn_input</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;magnitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">push_to_device</span><span class="p">()</span>

    <span class="c1"># Turn on correct output neuron</span>
    <span class="n">mbon_input</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;magnitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mbon_input</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;magnitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">[</span><span class="n">training_labels</span><span class="p">[</span><span class="n">s</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MBON_STIMULUS_CURRENT</span>
    <span class="n">mbon_input</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;magnitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">push_to_device</span><span class="p">()</span>

    <span class="c1"># Simulate present timesteps</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">present_timesteps</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">step_time</span><span class="p">()</span>

    <span class="c1"># Reset neuron state</span>
    <span class="n">reset_neuron</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">lif_init</span><span class="p">)</span>
    <span class="n">reset_neuron</span><span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="n">lif_init</span><span class="p">)</span>
    <span class="n">reset_neuron</span><span class="p">(</span><span class="n">ggn</span><span class="p">,</span> <span class="n">if_init</span><span class="p">)</span>
    <span class="n">reset_neuron</span><span class="p">(</span><span class="n">mbon</span><span class="p">,</span> <span class="n">lif_init</span><span class="p">)</span>

    <span class="c1"># Reset spike times</span>
    <span class="n">reset_spike_times</span><span class="p">(</span><span class="n">kc</span><span class="p">)</span>
    <span class="n">reset_spike_times</span><span class="p">(</span><span class="n">mbon</span><span class="p">)</span>

    <span class="c1"># Reset synapse state</span>
    <span class="n">reset_out_post</span><span class="p">(</span><span class="n">pn_kc</span><span class="p">)</span>
    <span class="n">reset_out_post</span><span class="p">(</span><span class="n">ggn_kc</span><span class="p">)</span>
    <span class="n">reset_out_post</span><span class="p">(</span><span class="n">kc_mbon</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "e4a549fa740647a9a4c257b70347b6dc"}</script></div>
</div>
</section>
<section id="Visualise-and-save-learned-weights">
<h2>Visualise and save learned weights<a class="headerlink" href="#Visualise-and-save-learned-weights" title="Permalink to this heading"></a></h2>
<p>First of all we download the learned weights from device and get the memory view to access them through (in the same way as we used to access current source state variables)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kc_mbon</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pull_from_device</span><span class="p">()</span>
<span class="n">kc_mbon_g_view</span> <span class="o">=</span> <span class="n">kc_mbon</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span>
</pre></div>
</div>
</div>
<p>now we plot a histogram of the weight distribution - as is typical when using STDP rules whose learning rate is independent of the current magnitude of the weight it is bimodal</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axis</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">kc_mbon_g_view</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">axis</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">kc_mbon_g_view</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Weight [nA]&quot;</span><span class="p">)</span>
<span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_mushroom_body_4_third_layer_31_0.png" src="../../_images/tutorials_mushroom_body_4_third_layer_31_0.png" />
</div>
</div>
<p>So we can reproduce exactly the same PN-&gt;KC connectivity again and reuse the weights we’ve learnt we want to save them back to YOUR google drive. First mount the drive</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;/content/drive&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mounted at /content/drive
</pre></div></div>
</div>
<p>Save the learnt weights</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;/content/drive/MyDrive/kc_mbon_g.npy&quot;</span><span class="p">,</span> <span class="n">kc_mbon_g_view</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Download the PN-&gt;KC connectivity from the GPU and save the sparse connectivity.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn_kc</span><span class="o">.</span><span class="n">pull_connectivity_from_device</span><span class="p">()</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;/content/drive/MyDrive/pn_kc_ind.npy&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pn_kc</span><span class="o">.</span><span class="n">get_sparse_pre_inds</span><span class="p">(),</span> <span class="n">pn_kc</span><span class="o">.</span><span class="n">get_sparse_post_inds</span><span class="p">())))</span>
</pre></div>
</div>
</div>
<script type="application/vnd.jupyter.widget-state+json">
{"e4a549fa740647a9a4c257b70347b6dc": {"model_module": "@jupyter-widgets/controls", "model_name": "HBoxModel", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_9331ce4de0d845d7bdba6eaf19733e3b", "IPY_MODEL_e98cca67c6dd4268b7fea6f8136b31cd", "IPY_MODEL_5456c8d419f1474cbe8cf0c3eca6fddc"], "layout": "IPY_MODEL_007cd41dc27e40aeb84f65b26c870a7c"}}, "9331ce4de0d845d7bdba6eaf19733e3b": {"model_module": "@jupyter-widgets/controls", "model_name": "HTMLModel", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_7ed5e1c9a13142939fcd1f7cf78243a1", "placeholder": "\u200b", "style": "IPY_MODEL_4f077d3f032f4a169a5f7eedf15f421c", "value": "100%"}}, "e98cca67c6dd4268b7fea6f8136b31cd": {"model_module": "@jupyter-widgets/controls", "model_name": "FloatProgressModel", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_7b2a461efd354bba8e96b6ed7b6c5f2d", "max": 60000, "min": 0, "orientation": "horizontal", "style": "IPY_MODEL_a0225294218b49cfa976eb59639f2f22", "value": 60000}}, "5456c8d419f1474cbe8cf0c3eca6fddc": {"model_module": "@jupyter-widgets/controls", "model_name": "HTMLModel", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_7c55bec89f144381b8f495e3aba48699", "placeholder": "\u200b", "style": "IPY_MODEL_e0ed35f603ed483abb7d79c569d45fd2", "value": "\u200760000/60000\u2007[02:55&lt;00:00,\u2007260.92it/s]"}}, "007cd41dc27e40aeb84f65b26c870a7c": {"model_module": "@jupyter-widgets/base", "model_name": "LayoutModel", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "7ed5e1c9a13142939fcd1f7cf78243a1": {"model_module": "@jupyter-widgets/base", "model_name": "LayoutModel", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "4f077d3f032f4a169a5f7eedf15f421c": {"model_module": "@jupyter-widgets/controls", "model_name": "DescriptionStyleModel", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "7b2a461efd354bba8e96b6ed7b6c5f2d": {"model_module": "@jupyter-widgets/base", "model_name": "LayoutModel", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "a0225294218b49cfa976eb59639f2f22": {"model_module": "@jupyter-widgets/controls", "model_name": "ProgressStyleModel", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "7c55bec89f144381b8f495e3aba48699": {"model_module": "@jupyter-widgets/base", "model_name": "LayoutModel", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "e0ed35f603ed483abb7d79c569d45fd2": {"model_module": "@jupyter-widgets/controls", "model_name": "DescriptionStyleModel", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}}
</script></section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="3_second_layer_gain_control.html" class="btn btn-neutral float-left" title="Feedback-inhibition based gain control" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="5_testing.html" class="btn btn-neutral float-right" title="Testing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, James Knight, Thomas Nowotny.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>