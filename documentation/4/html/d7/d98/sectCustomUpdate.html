<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>GeNN: Custom update models</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../multi-language-utils.js"></script>
<!--This is Google Analytics Tracking Code-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-57354659-1', 'auto');
  ga('send', 'pageview');
</script>
<!--End of Google Analytics Tracking Code-->
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="../../html_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em; padding-bottom: 0.5em;" id="projectlogo"><img alt="Logo" src="../../GeNN-logo-55px.gif"/></td>
  <td style="padding-left: 3.5em; padding-bottom: 0.5em;">
   <div id="projectname">GeNN
   &#160;<span id="projectnumber">4.7.1</span>
   </div>
   <div id="projectbrief">GPU enhanced Neuronal Networks (GeNN)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d7/d98/sectCustomUpdate.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Custom update models </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The neuron groups, synapse groups and current sources described in previous sections are all updated automatically every timestep. However, in many types of model, there are also processes that would benefit from GPU acceleration but only need to be triggered occasionally. For example, such updates could be used in a classifier to to reset the state of neurons after a stimuli has been presented or in a model which uses gradient-based learning to optimize network weights based on gradients accumulated over several timesteps.</p>
<p>Custom updates allows such updates to be described as models, similar to the neuron and synapse models described in the preceding sections. The custom update system also provides functionality for efficiently calculating the tranpose of variables associated with synapse groups with <a class="el" href="../../dd/dd5/synapseMatrixType_8h.html#a24a045033b9a7e987843a67ff5ddec9cac125fea63eb10ca9b8951ddbe787d7ce">SynapseMatrixType::DENSE_INDIVIDUALG</a> connectivity. The predefined <a class="el" href="../../d6/d4c/classCustomUpdateModels_1_1Transpose.html" title="Minimal custom update model for calculating tranpose. ">CustomUpdateModels::Transpose</a> model can be used to do just this for a synapse group with a single variable.</p>
<h1><a class="anchor" id="sect_own_custom_update"></a>
Defining your own custom update model</h1>
<p>In order to define a new custom update model for use in a GeNN application, it is necessary to define a new class derived from <a class="el" href="../../de/db4/classCustomUpdateModels_1_1Base.html" title="Base class for all current source models. ">CustomUpdateModels::Base</a>. For convenience the methods this class should implement can be implemented using <span class='toggleable_div label_cpp' style='display: none;'>macros</span><span class='toggleable_div label_python' style='display: none;'> keyword arguments </span>:</p><ul>
<li> <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/d6c/snippet_8h.html#aa592bfe3ce05ffc19a8f21d8482add6b">SET_DERIVED_PARAMS()</a>, <a class="el" href="../../de/d6c/snippet_8h.html#a75315265035fd71c5b5f7d7f449edbd7">SET_PARAM_NAMES()</a>, <a class="el" href="../../d4/d13/models_8h.html#a3025b9fc844fccdf8cc2b51ef4a6e0aa">SET_VARS()</a></span><span class='toggleable_div label_python' style='display: none;'> <code>derived_params</code>, <code>param_names</code>, <code>var_name_types</code> </span> perform the same roles as they do in the neuron models discussed in <a class="el" href="../../de/ded/sectNeuronModels.html#sect_own">Defining your own neuron type</a>.</li>
<li> <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../d3/df5/customUpdateModels_8h.html#acb2777aee9463ed36d489705851f74ed">DECLARE_CUSTOM_UPDATE_MODEL(TYPE, NUM_PARAMS, NUM_VARS, NUM_VAR_REFS)</a> is an extended version of <code><a class="el" href="../../d4/d13/models_8h.html#ae0c817e85c196f39cf62d608883cda13">DECLARE_MODEL()</a></code> which declares the boilerplate code required for a custom update with variable references as well as variables and parameters</span><span class='toggleable_div label_python' style='display: none;'><code>class_name</code>: the name of the new model </span>.</li>
<li> <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../d3/df5/customUpdateModels_8h.html#af5fc31e556cfb8724ac72739462fee53">SET_VAR_REFS()</a></span><span class='toggleable_div label_python' style='display: none;'><code>var_refs</code> </span> defines the names, type strings (e.g. "float", "double", etc) and (optionally) access mode of the variable references. The variables defined here as <code>NAME</code> can then be used in the syntax $(NAME) in the update code string. Variable reference types must match those of the underlying variables. supported access modes are <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ac9af5b5dbabe0b411cc7b2bca48ad72baa7b843fb734e3b3fea8e5f902d3f4144">VarAccessMode::READ_WRITE</a></span><span class='toggleable_div label_python' style='display: none;'> pygenn.genn_wrapper.Models.VarAccessMode_READ_WRITE </span> <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ac9af5b5dbabe0b411cc7b2bca48ad72ba47c7e7cb36a953a8c47e02000036bb44">VarAccessMode::READ_ONLY</a></span><span class='toggleable_div label_python' style='display: none;'>pygenn.genn_wrapper.Models.VarAccessMode_READ_ONLY</span>, <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ac9af5b5dbabe0b411cc7b2bca48ad72badc1f40b6ac21ec871b1ada167ac4ad86">VarAccessMode::REDUCE_SUM</a></span><span class='toggleable_div label_python' style='display: none;'> pygenn.genn_wrapper.Models.VarAccessMode_REDUCE_SUM </span> and <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ac9af5b5dbabe0b411cc7b2bca48ad72baea079a51906d4a31c2f0d9ad313d9c33">VarAccessMode::REDUCE_MAX</a></span><span class='toggleable_div label_python' style='display: none;'> pygenn.genn_wrapper.Models.VarAccessMode_REDUCE_MAX </span>.</li>
<li> <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../d3/df5/customUpdateModels_8h.html#a8d6d4a547def292ea8860a85ed80c1a7">SET_UPDATE_CODE(UPDATE_CODE)</a></span><span class='toggleable_div label_python' style='display: none;'><code>update_code=UPDATE_CODE</code> </span>: where UPDATE_CODE contains the code for to perform the custom update.</li>
</ul>
<p>For example, using these <span class='toggleable_div label_cpp' style='display: none;'>macros</span><span class='toggleable_div label_python' style='display: none;'>keyword arguments</span>, we can define a custom update which will set a referenced variable to the value of a custom update model state variable:  <div class='toggleable_div label_cpp' style='display: none;'></p><div class="fragment"><div class="line"><span class="keyword">class </span>Reset : <span class="keyword">public</span> <a class="code" href="../../de/db4/classCustomUpdateModels_1_1Base.html">CustomUpdateModels::Base</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="../../d3/df5/customUpdateModels_8h.html#acb2777aee9463ed36d489705851f74ed">DECLARE_CUSTOM_UPDATE_MODEL</a>(Reset, 0, 1, 1);</div><div class="line"></div><div class="line">    <a class="code" href="../../d3/df5/customUpdateModels_8h.html#a8d6d4a547def292ea8860a85ed80c1a7">SET_UPDATE_CODE</a>(<span class="stringliteral">&quot;$(r) = $(v);&quot;</span>);</div><div class="line"></div><div class="line">    <a class="code" href="../../d4/d13/models_8h.html#a3025b9fc844fccdf8cc2b51ef4a6e0aa">SET_VARS</a>({{<span class="stringliteral">&quot;v&quot;</span>, <span class="stringliteral">&quot;scalar&quot;</span>, <a class="code" href="../../de/dfb/varAccess_8h.html#ae8a5891c5d3beb45321e2f850539452fa47c7e7cb36a953a8c47e02000036bb44">VarAccess::READ_ONLY</a>}});</div><div class="line">    <a class="code" href="../../d3/df5/customUpdateModels_8h.html#af5fc31e556cfb8724ac72739462fee53">SET_VAR_REFS</a>({{<span class="stringliteral">&quot;r&quot;</span>, <span class="stringliteral">&quot;scalar&quot;</span>, <a class="code" href="../../de/dfb/varAccess_8h.html#ac9af5b5dbabe0b411cc7b2bca48ad72baa7b843fb734e3b3fea8e5f902d3f4144">VarAccessMode::READ_WRITE</a>}, </div><div class="line">};</div></div><!-- fragment --><p> </div>  <div class='toggleable_div label_python' style='display: none;'></p><div class="fragment"><div class="line">reset_model = genn_model.create_custom_custom_update_class(</div><div class="line">    <span class="stringliteral">&quot;reset&quot;</span>,</div><div class="line"></div><div class="line">    var_name_types=[(<span class="stringliteral">&quot;v&quot;</span>, <span class="stringliteral">&quot;scalar&quot;</span>, VarAccess_READ_ONLY)],</div><div class="line">    var_refs=[(<span class="stringliteral">&quot;r&quot;</span>, <span class="stringliteral">&quot;scalar&quot;</span>, VarAccessMode_READ_WRITE)],</div><div class="line">    update_code=<span class="stringliteral">&quot;$(r) = $(v);&quot;</span>)</div></div><!-- fragment --><p> </div></p>
<p>When used in a model with batch size &gt; 1, whether custom updates of this sort are batched or not depends on the variables their references point to. If any referenced variables have <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ae8a5891c5d3beb45321e2f850539452fa5ab0957a4a1eb6967baa754d809e93ae">VarAccess::READ_ONLY_DUPLICATE</a></span><span class='toggleable_div label_python' style='display: none;'> pygenn.genn_wrapper.Models.VarAccess_READ_ONLY_DUPLICATE </span> or <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ae8a5891c5d3beb45321e2f850539452faa7b843fb734e3b3fea8e5f902d3f4144">VarAccess::READ_WRITE</a></span><span class='toggleable_div label_python' style='display: none;'> pygenn.genn_wrapper.Models.VarAccess_READ_WRITE </span> access modes, then the update will be batched and any variables associated with the custom update which also have <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ae8a5891c5d3beb45321e2f850539452fa5ab0957a4a1eb6967baa754d809e93ae">VarAccess::READ_ONLY_DUPLICATE</a></span><span class='toggleable_div label_python' style='display: none;'> pygenn.genn_wrapper.Models.VarAccess_READ_ONLY_DUPLICATE </span> or <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ae8a5891c5d3beb45321e2f850539452faa7b843fb734e3b3fea8e5f902d3f4144">VarAccess::READ_WRITE</a></span><span class='toggleable_div label_python' style='display: none;'> pygenn.genn_wrapper.Models.VarAccess_READ_WRITE </span> access modes will be duplicated across the batches.</p>
<h2><a class="anchor" id="custom_update_reduction"></a>
Batch reduction</h2>
<p>As well as the standard variable access modes described in <a class="el" href="../../df/dc3/sectDefiningNetwork.html#subsect11">Defining neuron populations</a>, custom updates support variables with several 'reduction' access modes:</p><ul>
<li> <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ae8a5891c5d3beb45321e2f850539452fa209f91e16acd067fe7b41d1fdcfe42f5">VarAccess::REDUCE_BATCH_SUM</a></span><span class='toggleable_div label_python' style='display: none;'> <code>pygenn.genn_wrapper.Models.VarAccess_REDUCE_BATCH_SUM</code> </span></li>
<li> <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ae8a5891c5d3beb45321e2f850539452fac48cd0859cd894a5ce16fde3338a4d86">VarAccess::REDUCE_BATCH_MAX</a></span><span class='toggleable_div label_python' style='display: none;'> <code>pygenn.genn_wrapper.Models.VarAccess_REDUCE_BATCH_MAX</code> </span></li>
</ul>
<p>These access modes allow values read from variables duplicated across batches to be reduced into variables that are shared across batches. For example, in a gradient-based learning scenario, a model like this could be used to sum gradients from across all batches so they can be used as the input to a learning rule operating on shared synaptic weights:</p>
<p> <div class='toggleable_div label_cpp' style='display: none;'></p><div class="fragment"><div class="line"><span class="keyword">class </span>Reset : <span class="keyword">public</span> <a class="code" href="../../de/db4/classCustomUpdateModels_1_1Base.html">CustomUpdateModels::Base</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="../../d3/df5/customUpdateModels_8h.html#acb2777aee9463ed36d489705851f74ed">DECLARE_CUSTOM_UPDATE_MODEL</a>(Reset, 0, 1, 1);</div><div class="line"></div><div class="line">    <a class="code" href="../../d3/df5/customUpdateModels_8h.html#a8d6d4a547def292ea8860a85ed80c1a7">SET_UPDATE_CODE</a>(</div><div class="line">        <span class="stringliteral">&quot;$(reducedGradient) = $(gradient);\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;$(gradient) = 0;\n&quot;</span>);</div><div class="line"></div><div class="line">    <a class="code" href="../../d4/d13/models_8h.html#a3025b9fc844fccdf8cc2b51ef4a6e0aa">SET_VARS</a>({{<span class="stringliteral">&quot;reducedGradient&quot;</span>, <span class="stringliteral">&quot;scalar&quot;</span>, <a class="code" href="../../de/dfb/varAccess_8h.html#ae8a5891c5d3beb45321e2f850539452fa209f91e16acd067fe7b41d1fdcfe42f5">VarAccess::REDUCE_BATCH_SUM</a>}});</div><div class="line">    <a class="code" href="../../d3/df5/customUpdateModels_8h.html#af5fc31e556cfb8724ac72739462fee53">SET_VAR_REFS</a>({{<span class="stringliteral">&quot;gradient&quot;</span>, <span class="stringliteral">&quot;scalar&quot;</span>, <a class="code" href="../../de/dfb/varAccess_8h.html#ac9af5b5dbabe0b411cc7b2bca48ad72ba47c7e7cb36a953a8c47e02000036bb44">VarAccessMode::READ_ONLY</a>}, </div><div class="line">};</div></div><!-- fragment --><p> </div>  <div class='toggleable_div label_python' style='display: none;'></p><div class="fragment"><div class="line">gradient_batch_reduce_model = genn_model.create_custom_custom_update_class(</div><div class="line">    <span class="stringliteral">&quot;gradient_batch_reduce&quot;</span>,</div><div class="line">    var_name_types=[(<span class="stringliteral">&quot;reducedGradient&quot;</span>, <span class="stringliteral">&quot;scalar&quot;</span>, VarAccess_REDUCE_BATCH_SUM)],</div><div class="line">    var_refs=[(<span class="stringliteral">&quot;gradient&quot;</span>, <span class="stringliteral">&quot;scalar&quot;</span>, VarAccessMode_READ_ONLY)],</div><div class="line">    update_code=<span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;</span></div><div class="line"><span class="stringliteral">    $(reducedGradient) = $(gradient);</span></div><div class="line"><span class="stringliteral">    $(gradient) = 0;</span></div><div class="line"><span class="stringliteral">    &quot;</span><span class="stringliteral">&quot;&quot;</span>)</div></div><!-- fragment --><p> </div></p>
<p>Custom updates can also perform the same sort of reduction operation <em>into</em> variable references with the equivalent 'reduction' access modes:</p><ul>
<li> <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ac9af5b5dbabe0b411cc7b2bca48ad72badc1f40b6ac21ec871b1ada167ac4ad86">VarAccessMode::REDUCE_SUM</a></span><span class='toggleable_div label_python' style='display: none;'> <code>pygenn.genn_wrapper.Models.VarAccess_REDUCE_SUM</code> </span></li>
<li> <span class='toggleable_div label_cpp' style='display: none;'><a class="el" href="../../de/dfb/varAccess_8h.html#ac9af5b5dbabe0b411cc7b2bca48ad72baea079a51906d4a31c2f0d9ad313d9c33">VarAccessMode::REDUCE_MAX</a></span><span class='toggleable_div label_python' style='display: none;'> <code>pygenn.genn_wrapper.Models.VarAccess_REDUCE_MAX</code> </span></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Reading from variables with a reduction access mode is undefined behaviour.</dd></dl>
<hr/>
<p> <a class="el" href="../../d0/d1e/sectCurrentSourceModels.html">Previous</a> | <a class="el" href="../../dc/d05/UserManual.html">Top</a> | <a class="el" href="../../d5/d39/subsect34.html">Next</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dc/d05/UserManual.html">User Manual</a></li>
    <li class="footer">Generated on Fri Apr 29 2022 10:38:21 for GeNN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
<script type="text/javascript">
//<![CDATA[
addLanguageToggleButtons();
//]]>
</script>
</body>
</html>
